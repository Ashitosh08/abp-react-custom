{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function get() {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function sent() {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.AuthProvider = exports.initUserManager = exports.hasCodeInUrl = exports.AuthContext = void 0;\nvar react_1 = __importStar(require(\"react\"));\nvar oidc_client_ts_1 = require(\"oidc-client-ts\");\nexports.AuthContext = react_1.default.createContext(undefined);\n/**\n * @private\n * @hidden\n * @param location\n */\nvar hasCodeInUrl = function hasCodeInUrl(location) {\n  var searchParams = new URLSearchParams(location.search);\n  var hashParams = new URLSearchParams(location.hash.replace('#', '?'));\n  return Boolean(searchParams.get('code') || searchParams.get('id_token') || searchParams.get('session_state') || hashParams.get('code') || hashParams.get('id_token') || hashParams.get('session_state'));\n};\nexports.hasCodeInUrl = hasCodeInUrl;\n/**\n * @private\n * @hidden\n * @param props\n */\nvar initUserManager = function initUserManager(props) {\n  if (props.userManager) return props.userManager;\n  var authority = props.authority,\n    clientId = props.clientId,\n    clientSecret = props.clientSecret,\n    redirectUri = props.redirectUri,\n    silentRedirectUri = props.silentRedirectUri,\n    postLogoutRedirectUri = props.postLogoutRedirectUri,\n    responseType = props.responseType,\n    scope = props.scope,\n    automaticSilentRenew = props.automaticSilentRenew,\n    loadUserInfo = props.loadUserInfo,\n    popupWindowFeatures = props.popupWindowFeatures,\n    popupRedirectUri = props.popupRedirectUri,\n    popupWindowTarget = props.popupWindowTarget,\n    extraQueryParams = props.extraQueryParams;\n  return new oidc_client_ts_1.UserManager({\n    authority: authority || '',\n    client_id: clientId || '',\n    client_secret: clientSecret,\n    redirect_uri: redirectUri || '',\n    silent_redirect_uri: silentRedirectUri || redirectUri,\n    post_logout_redirect_uri: postLogoutRedirectUri || redirectUri,\n    response_type: responseType || 'code',\n    scope: scope || 'openid',\n    loadUserInfo: loadUserInfo !== undefined ? loadUserInfo : true,\n    popupWindowFeatures: popupWindowFeatures,\n    popup_redirect_uri: popupRedirectUri,\n    popupWindowTarget: popupWindowTarget,\n    automaticSilentRenew: automaticSilentRenew,\n    extraQueryParams: extraQueryParams\n  });\n};\nexports.initUserManager = initUserManager;\n/**\n *\n * @param props AuthProviderProps\n */\nvar AuthProvider = function AuthProvider(_a) {\n  var children = _a.children,\n    _b = _a.autoSignIn,\n    autoSignIn = _b === void 0 ? true : _b,\n    onBeforeSignIn = _a.onBeforeSignIn,\n    onSignIn = _a.onSignIn,\n    onSignOut = _a.onSignOut,\n    _c = _a.location,\n    location = _c === void 0 ? window.location : _c,\n    props = __rest(_a, [\"children\", \"autoSignIn\", \"onBeforeSignIn\", \"onSignIn\", \"onSignOut\", \"location\"]);\n  var _d = (0, react_1.useState)(true),\n    isLoading = _d[0],\n    setIsLoading = _d[1];\n  var _e = (0, react_1.useState)(null),\n    userData = _e[0],\n    setUserData = _e[1];\n  var userManager = (0, react_1.useState)(function () {\n    return (0, exports.initUserManager)(props);\n  })[0];\n  var signOutHooks = (0, react_1.useCallback)(function () {\n    return __awaiter(void 0, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        setUserData(null);\n        onSignOut && onSignOut();\n        return [2 /*return*/];\n      });\n    });\n  }, [onSignOut]);\n  var signInPopupHooks = (0, react_1.useCallback)(function () {\n    return __awaiter(void 0, void 0, void 0, function () {\n      var userFromPopup;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, userManager.signinPopup()];\n          case 1:\n            userFromPopup = _a.sent();\n            setUserData(userFromPopup);\n            onSignIn && onSignIn(userFromPopup);\n            return [4 /*yield*/, userManager.signinPopupCallback()];\n          case 2:\n            _a.sent();\n            return [2 /*return*/];\n        }\n      });\n    });\n  }, [userManager, onSignIn]);\n  var isMountedRef = (0, react_1.useRef)(true);\n  (0, react_1.useEffect)(function () {\n    return function () {\n      isMountedRef.current = false;\n    };\n  }, []);\n  (0, react_1.useEffect)(function () {\n    (function () {\n      return __awaiter(void 0, void 0, void 0, function () {\n        var isMounted, user_1, user, state;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              isMounted = isMountedRef.current;\n              if (!(0, exports.hasCodeInUrl)(location)) return [3 /*break*/, 2];\n              return [4 /*yield*/, userManager.signinCallback()];\n            case 1:\n              user_1 = _a.sent() || null;\n              setUserData(user_1);\n              setIsLoading(false);\n              onSignIn && onSignIn(user_1);\n              return [2 /*return*/];\n            case 2:\n              return [4 /*yield*/, userManager.getUser()];\n            case 3:\n              user = _a.sent();\n              if ((!user || user.expired) && autoSignIn) {\n                state = onBeforeSignIn ? onBeforeSignIn() : undefined;\n                userManager.signinRedirect({\n                  state: state\n                });\n              } else if (isMounted) {\n                setUserData(user);\n                setIsLoading(false);\n              }\n              return [2 /*return*/];\n          }\n        });\n      });\n    })();\n  }, [location, userManager, autoSignIn, onBeforeSignIn, onSignIn]);\n  (0, react_1.useEffect)(function () {\n    // for refreshing react state when new state is available in e.g. session storage\n    var updateUserData = function updateUserData() {\n      return __awaiter(void 0, void 0, void 0, function () {\n        var user;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              return [4 /*yield*/, userManager.getUser()];\n            case 1:\n              user = _a.sent();\n              isMountedRef.current && setUserData(user);\n              return [2 /*return*/];\n          }\n        });\n      });\n    };\n\n    userManager.events.addUserLoaded(updateUserData);\n    return function () {\n      return userManager.events.removeUserLoaded(updateUserData);\n    };\n  }, [userManager]);\n  var value = (0, react_1.useMemo)(function () {\n    return {\n      signIn: function signIn(args) {\n        return __awaiter(void 0, void 0, void 0, function () {\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                return [4 /*yield*/, userManager.signinRedirect(args)];\n              case 1:\n                _a.sent();\n                return [2 /*return*/];\n            }\n          });\n        });\n      },\n\n      signInPopup: function signInPopup() {\n        return __awaiter(void 0, void 0, void 0, function () {\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                return [4 /*yield*/, signInPopupHooks()];\n              case 1:\n                _a.sent();\n                return [2 /*return*/];\n            }\n          });\n        });\n      },\n\n      signOut: function signOut() {\n        return __awaiter(void 0, void 0, void 0, function () {\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                return [4 /*yield*/, userManager.removeUser()];\n              case 1:\n                _a.sent();\n                return [4 /*yield*/, signOutHooks()];\n              case 2:\n                _a.sent();\n                return [2 /*return*/];\n            }\n          });\n        });\n      },\n\n      signOutRedirect: function signOutRedirect(args) {\n        return __awaiter(void 0, void 0, void 0, function () {\n          return __generator(this, function (_a) {\n            switch (_a.label) {\n              case 0:\n                return [4 /*yield*/, userManager.signoutRedirect(args)];\n              case 1:\n                _a.sent();\n                return [4 /*yield*/, signOutHooks()];\n              case 2:\n                _a.sent();\n                return [2 /*return*/];\n            }\n          });\n        });\n      },\n\n      userManager: userManager,\n      userData: userData,\n      isLoading: isLoading\n    };\n  }, [userManager, isLoading, userData, signInPopupHooks, signOutHooks]);\n  return react_1.default.createElement(exports.AuthContext.Provider, {\n    value: value\n  }, children);\n};\nexports.AuthProvider = AuthProvider;","map":{"version":3,"sources":["../../src/AuthContext.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AuthProvider = exports.initUserManager = exports.hasCodeInUrl = exports.AuthContext = void 0;\nvar react_1 = __importStar(require(\"react\"));\nvar oidc_client_ts_1 = require(\"oidc-client-ts\");\nexports.AuthContext = react_1.default.createContext(undefined);\n/**\n * @private\n * @hidden\n * @param location\n */\nvar hasCodeInUrl = function (location) {\n    var searchParams = new URLSearchParams(location.search);\n    var hashParams = new URLSearchParams(location.hash.replace('#', '?'));\n    return Boolean(searchParams.get('code') ||\n        searchParams.get('id_token') ||\n        searchParams.get('session_state') ||\n        hashParams.get('code') ||\n        hashParams.get('id_token') ||\n        hashParams.get('session_state'));\n};\nexports.hasCodeInUrl = hasCodeInUrl;\n/**\n * @private\n * @hidden\n * @param props\n */\nvar initUserManager = function (props) {\n    if (props.userManager)\n        return props.userManager;\n    var authority = props.authority, clientId = props.clientId, clientSecret = props.clientSecret, redirectUri = props.redirectUri, silentRedirectUri = props.silentRedirectUri, postLogoutRedirectUri = props.postLogoutRedirectUri, responseType = props.responseType, scope = props.scope, automaticSilentRenew = props.automaticSilentRenew, loadUserInfo = props.loadUserInfo, popupWindowFeatures = props.popupWindowFeatures, popupRedirectUri = props.popupRedirectUri, popupWindowTarget = props.popupWindowTarget, extraQueryParams = props.extraQueryParams;\n    return new oidc_client_ts_1.UserManager({\n        authority: authority || '',\n        client_id: clientId || '',\n        client_secret: clientSecret,\n        redirect_uri: redirectUri || '',\n        silent_redirect_uri: silentRedirectUri || redirectUri,\n        post_logout_redirect_uri: postLogoutRedirectUri || redirectUri,\n        response_type: responseType || 'code',\n        scope: scope || 'openid',\n        loadUserInfo: loadUserInfo !== undefined ? loadUserInfo : true,\n        popupWindowFeatures: popupWindowFeatures,\n        popup_redirect_uri: popupRedirectUri,\n        popupWindowTarget: popupWindowTarget,\n        automaticSilentRenew: automaticSilentRenew,\n        extraQueryParams: extraQueryParams\n    });\n};\nexports.initUserManager = initUserManager;\n/**\n *\n * @param props AuthProviderProps\n */\nvar AuthProvider = function (_a) {\n    var children = _a.children, _b = _a.autoSignIn, autoSignIn = _b === void 0 ? true : _b, onBeforeSignIn = _a.onBeforeSignIn, onSignIn = _a.onSignIn, onSignOut = _a.onSignOut, _c = _a.location, location = _c === void 0 ? window.location : _c, props = __rest(_a, [\"children\", \"autoSignIn\", \"onBeforeSignIn\", \"onSignIn\", \"onSignOut\", \"location\"]);\n    var _d = (0, react_1.useState)(true), isLoading = _d[0], setIsLoading = _d[1];\n    var _e = (0, react_1.useState)(null), userData = _e[0], setUserData = _e[1];\n    var userManager = (0, react_1.useState)(function () { return (0, exports.initUserManager)(props); })[0];\n    var signOutHooks = (0, react_1.useCallback)(function () { return __awaiter(void 0, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            setUserData(null);\n            onSignOut && onSignOut();\n            return [2 /*return*/];\n        });\n    }); }, [onSignOut]);\n    var signInPopupHooks = (0, react_1.useCallback)(function () { return __awaiter(void 0, void 0, void 0, function () {\n        var userFromPopup;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, userManager.signinPopup()];\n                case 1:\n                    userFromPopup = _a.sent();\n                    setUserData(userFromPopup);\n                    onSignIn && onSignIn(userFromPopup);\n                    return [4 /*yield*/, userManager.signinPopupCallback()];\n                case 2:\n                    _a.sent();\n                    return [2 /*return*/];\n            }\n        });\n    }); }, [userManager, onSignIn]);\n    var isMountedRef = (0, react_1.useRef)(true);\n    (0, react_1.useEffect)(function () {\n        return function () {\n            isMountedRef.current = false;\n        };\n    }, []);\n    (0, react_1.useEffect)(function () {\n        (function () { return __awaiter(void 0, void 0, void 0, function () {\n            var isMounted, user_1, user, state;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        isMounted = isMountedRef.current;\n                        if (!(0, exports.hasCodeInUrl)(location)) return [3 /*break*/, 2];\n                        return [4 /*yield*/, userManager.signinCallback()];\n                    case 1:\n                        user_1 = (_a.sent()) || null;\n                        setUserData(user_1);\n                        setIsLoading(false);\n                        onSignIn && onSignIn(user_1);\n                        return [2 /*return*/];\n                    case 2: return [4 /*yield*/, userManager.getUser()];\n                    case 3:\n                        user = _a.sent();\n                        if ((!user || user.expired) && autoSignIn) {\n                            state = onBeforeSignIn ? onBeforeSignIn() : undefined;\n                            userManager.signinRedirect({ state: state });\n                        }\n                        else if (isMounted) {\n                            setUserData(user);\n                            setIsLoading(false);\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        }); })();\n    }, [location, userManager, autoSignIn, onBeforeSignIn, onSignIn]);\n    (0, react_1.useEffect)(function () {\n        // for refreshing react state when new state is available in e.g. session storage\n        var updateUserData = function () { return __awaiter(void 0, void 0, void 0, function () {\n            var user;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, userManager.getUser()];\n                    case 1:\n                        user = _a.sent();\n                        isMountedRef.current && setUserData(user);\n                        return [2 /*return*/];\n                }\n            });\n        }); };\n        userManager.events.addUserLoaded(updateUserData);\n        return function () { return userManager.events.removeUserLoaded(updateUserData); };\n    }, [userManager]);\n    var value = (0, react_1.useMemo)(function () {\n        return {\n            signIn: function (args) { return __awaiter(void 0, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, userManager.signinRedirect(args)];\n                        case 1:\n                            _a.sent();\n                            return [2 /*return*/];\n                    }\n                });\n            }); },\n            signInPopup: function () { return __awaiter(void 0, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, signInPopupHooks()];\n                        case 1:\n                            _a.sent();\n                            return [2 /*return*/];\n                    }\n                });\n            }); },\n            signOut: function () { return __awaiter(void 0, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, userManager.removeUser()];\n                        case 1:\n                            _a.sent();\n                            return [4 /*yield*/, signOutHooks()];\n                        case 2:\n                            _a.sent();\n                            return [2 /*return*/];\n                    }\n                });\n            }); },\n            signOutRedirect: function (args) { return __awaiter(void 0, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0: return [4 /*yield*/, userManager.signoutRedirect(args)];\n                        case 1:\n                            _a.sent();\n                            return [4 /*yield*/, signOutHooks()];\n                        case 2:\n                            _a.sent();\n                            return [2 /*return*/];\n                    }\n                });\n            }); },\n            userManager: userManager,\n            userData: userData,\n            isLoading: isLoading,\n        };\n    }, [userManager, isLoading, userData, signInPopupHooks, signOutHooks]);\n    return (react_1.default.createElement(exports.AuthContext.Provider, { value: value }, children));\n};\nexports.AuthProvider = AuthProvider;\n//# sourceMappingURL=AuthContext.js.map"]},"metadata":{},"sourceType":"script"}